---
title: "How Socioeconomic Factors Affect Average Age of First Birth in Canada"

author: 
  - Sevnur Kulak
  - Dongqi Bi
  - Ivan Li
thanks: "Code and data are available at: https://github.com/hellowoshibb/Age_of_First_Birth_Analysis"
date: "`r format(Sys.time(), '%d %B %Y')`"
abstract: "write abstract here"
output: 
  bookdown::pdf_document2:
    fig_caption: yes
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(hash)
library(dplyr)
library(forcats)
library(knitr)
library(janitor)
library(tidyverse)
library(tidyr)
library(wrapr)
library(haven)
library(ggplot2)
library(gridExtra)
```



# Introduction


# Data

```{r, message=FALSE, cache=TRUE, warning = FALSE, echo = FALSE}
#read gss raw data
gss <- read_csv(here::here("input/data/gss.csv"))
```

```{r, age-first-child, fig.cap="Distribution of age at which respondents have their first child ",warning=FALSE, echo=FALSE, results='hide',fig.keep='all', message=FALSE}

gss_afb <- gss |>
  select(age_at_first_birth, sex) |>
  na.omit()


gss_afb |>
  ggplot(mapping = aes(x = age_at_first_birth))+
  geom_histogram(fill="steelblue3", colour = "white", aes(y = (..count..)/sum(..count..)))+
  labs(x = "Age at first birth",
       y = "Proportion of respondents",
       fill = "Proportion of respondents")+
  theme_classic()

```



```{r, female-age-first-child, fig.cap="Distribution of age at which respondents have their first child by gender ", warning=FALSE, echo=FALSE,results='hide',fig.keep='all', message=FALSE}

gss_afb <- gss |>
  select(age_at_first_birth, sex) |>
  na.omit()

p1 <- gss_afb |>
  filter(sex == "Female") |>
  ggplot(mapping = aes(x = age_at_first_birth))+
  geom_histogram(aes(y = (..count..)/sum(..count..)), fill="steelblue3", colour = "white")+
  labs(x = "Age at first birth (Female)",
       y = "Proportion of respondents",
       fill = "Proportion of respondents")+
  theme(plot.title = element_text(size=10))+
  theme_classic()


  
p2 <- gss_afb |>
  filter(sex == "Male") |>
  ggplot(mapping = aes(x = age_at_first_birth))+
  geom_histogram(aes(y = (..count..)/sum(..count..)), fill="steelblue3", colour = "white")+
  labs(x = "Age at first birth (Male)",
       y = "Proportion of respondents",
       fill = "Proportion of respondents")+
  theme(plot.title = element_text(size=10))+
  theme_classic()

cowplot::plot_grid(p1, p2)

```

```{r, education, fig.cap="Distribution of age at which respondents have their first child by education levels ", warning=FALSE, echo=FALSE,results='hide',fig.keep='all',, message=FALSE}

ed <- gss |>
  select(age_at_first_birth, education)|>
  filter(education == "High school diploma or a high school equivalency certificate" |
         education == "Less than high school diploma or its equivalent" |
         education == "Bachelor's degree (e.g. B.A., B.Sc., LL.B.)"|
        education == "University certificate, diploma or degree above the bach...")
  
ed[ed == "High school diploma or a high school equivalency certificate"] <- "High School"
ed[ed == "Less than high school diploma or its equivalent"] <- "Less than high school"
ed[ed == "Bachelor's degree (e.g. B.A., B.Sc., LL.B.)"] <- "Bachelor"
ed[ed == "University certificate, diploma or degree above the bach..."] <- "Above Bachelor"

ed |>
  ggplot(mapping = aes(x = age_at_first_birth, fill=education))+
  geom_histogram(aes(y = (..count..)/sum(..count..)),colour = "white")+
  labs(x = "Age at first birth",
       y = "Counts of respondents",
       fill = "Education levels")+
  scale_fill_manual(values = c("steelblue1","steelblue2", "steelblue3", "steelblue4"))+
  theme_classic()
```




```{r, income, fig.cap="Part1 : Distribution of age at which respondents have their first child by occupation and income", fig.height=20, warning=FALSE, echo=FALSE,results='hide',fig.keep='all', message=FALSE}

oc <- gss |>
  select(age_at_first_birth, occupation, income_respondent)|>
  filter(occupation == "Business, finance, and administration occupations" |
         occupation == "Sales and service occupations" |
         occupation == "Health occupations"|
         occupation == "Management occupations")
  
oc[oc == "Business, finance, and administration occupations"] <- "Business occupation"
oc[oc == "Sales and service occupations"] <- "Sales occupation"
oc[oc == "Management occupations"] <- "Management occupations"


p1 = oc %>% mutate(income_respondent = fct_relevel(income_respondent, 
            "Less than $25,000", "$25,000 to $49,999", "$50,000 to $74,999", "$75,000 to $99,999","$100,000 to $ 124,999", "$125,000 and more" )) |> filter(occupation == "Health occupations") |>  ggplot(aes(x=income_respondent, y=age_at_first_birth)) +
  geom_boxplot(colour = 'green4')+  geom_jitter(alpha = 0.3, width = 0.05, height = 0, colour = 'green4')+
  labs(title = "Health Occupation Distribution" ,,
       color = "Occupation")+
  theme(axis.text.x = element_text(angle = 35)) + labs(x='Income', y='Age at First Birth')

p2 = oc %>% mutate(income_respondent = fct_relevel(income_respondent, 
            "Less than $25,000", "$25,000 to $49,999", "$50,000 to $74,999", "$75,000 to $99,999","$100,000 to $ 124,999", "$125,000 and more" )) |> filter(occupation == "Business occupation") |>  ggplot(aes(x=income_respondent, y=age_at_first_birth)) +
  geom_boxplot(colour = 'gold3')+  geom_jitter(alpha = 0.3, width = 0.05, height = 0, colour = 'gold3')+
  labs(title = "Business Occupation Distribution" ,,
       color = "Occupation")+
  theme(axis.text.x = element_text(angle = 35)) + labs(x='Income', y='Age at First Birth')

p3 = oc %>% mutate(income_respondent = fct_relevel(income_respondent, 
            "Less than $25,000", "$25,000 to $49,999", "$50,000 to $74,999", "$75,000 to $99,999","$100,000 to $ 124,999", "$125,000 and more" )) |> filter(occupation == "Sales occupation") |>  ggplot(aes(x=income_respondent, y=age_at_first_birth)) +
  geom_boxplot(colour = 'blue')+  geom_jitter(alpha = 0.3, width = 0.05, height = 0, colour = 'blue')+
  labs(title = "Sales Occupation Distribution" ,,
       color = "Occupation")+
  theme(axis.text.x = element_text(angle = 35)) + labs(x='Income', y='Age at First Birth')

p4 = oc %>% mutate(income_respondent = fct_relevel(income_respondent, 
            "Less than $25,000", "$25,000 to $49,999", "$50,000 to $74,999", "$75,000 to $99,999","$100,000 to $ 124,999", "$125,000 and more" )) |> filter(occupation == "Management occupations") |>  ggplot(aes(x=income_respondent, y=age_at_first_birth)) +
  geom_boxplot(colour = 'red')+  geom_jitter(alpha=0.3, width = 0.05, height = 0, colour = 'red')+
  labs(title = "Management Occupation Distribution" ,,
       color = "Occupation")+
  theme(axis.text.x = element_text(angle = 35)) + labs(x='Income', y='Age at First Birth')

cowplot::plot_grid(p1, p2, nrow=2)

```

```{r, income2, fig.cap="Part2 : Distribution of age at which respondents have their first child by occupation and income", fig.height=20, warning=FALSE, echo=FALSE,results='hide',fig.keep='all', message=FALSE}
cowplot::plot_grid(p3, p4, nrow=2)
```


```{r, feelings, fig.cap="Age at which having their first child vs feelings about life as a whole", warning=FALSE, echo=FALSE, results='hide',fig.keep='all', message=FALSE}


gss_fl <- gss%>%
  select(feelings_life, age_at_first_birth) %>%
  na.omit()%>%
  group_by(feelings_life) %>%
  mutate(mean = mean(age_at_first_birth))%>%
  rename(mean_age = `mean`)



gss_fl %>%
 ggplot(aes(x=feelings_life, y=age_at_first_birth)) +
   geom_point(size = 0.05, color = "steelblue1")+
  geom_line(aes(x = feelings_life, y = mean_age), size = 1)+
  labs(x = "Satisfaction with life scale", y = "Age at first birth")
  theme_classic()


```
The dataset we chose is collected from the Canadian General Social Survey (GSS) Cycle 31 Main Survey - Family. The GSS program was developed in 1985 in Canada with six survey themes, each focusing on a different topic in depth. (reference 1) The six themes are caregiving, families, time use, social identity, volunteering, and victimization. (reference 1) Each of them is used to aim at a different aspect of improving Canadian’s well-being, informing social research, and acting as an effective training tool for quantitative analysis. (reference 1) Our paper is interested in the socioeconomic factors that could potentially affect the average age of first birth in Canada. Since our subject is closely related to the parental history, household information, education and health information of Canadian families, and these are the survey's subjects; we choose the "Families" theme over other themes. It contains all the variable information that we needed.

In particular, we choose Cycle 31 of the GSS Families survey; The data is collected from 2017-02-01 to 2017-11-30  with a target demographic of all non-institutionalized people aged 15 and up who live in Canada’s ten provinces. (reference2). The data is collected using a cross-sectional design, combing landline and cellular telephone numbers. (reference2) The selection process of the data collection used a stratified sampling method, a method of dividing a population into smaller groups called strata and selecting random samples from each strat (reference3). In this survey, the strata are at the province level; proxy replies are not authorized for this survey.


Our response variable is "age at first birth," which is the respondent's age when they have their first child. We used other variables in this paper as factors to analyze their relationships with the response variable is gender , including females and males. Income levels which contains 6 levels: Less than $25,000, $25,000 to $49,999, $50,000 to $74,999, $75,000 to $99,999, $100,000 to $124,999 and $125,000 and more. Occupation types include heath occupation, business occupation, sales occupation and management occupation. And the respondent's rating about the level of satisfaction with life scaling from 1 to 10. 


Figure1, we have the distribution of age at which respondents have their first child. The x-axis is the age at which respondents have their first child, and the y-axis shows the percentage of the respondents in this age group of the entire sample. The age group is divided evenly into small groups with individual bars representing them from age 18 to age 45. Each bar is approximately representing one year of age. At two endpoints of the graphs, the first bar represents age 18 and under age 18, and the last bar represents age 45 and above age 45. The heights of the bars show the popularity of this age group. Figure 2 is similar to figure 1; the difference is that we divide the distribution graph by gender, and we use it to analyze how gender as a factor influences the age of people who have their first child.  Figure 3 is another distribution graph; we split the distribution into different education levels, we can see the portion of people in each education level in a diverse age group. For instance, at age 25, most people have their first kid in a high school education level, and a tiny portion of people have above bachelor education. In figure 4 and figure 5, we have four boxplots. Each boxplot analyzes data based on one type of occupation; we have heath, business, sales and Management. Each boxplot also contains six boxes representing an income level from less than $25,000 to more than $125,000. Within each box, it draws from the first to the third quartile of the data of age at which respondents have their first child. At the median, a vertical run through the box. We also add raw data points to our boxplots to better visualize the distribution of data points. In our last graph, figure 6, we have x-axis as the respondents rating regarding their satisfaction with life from 1 to 10, and y-axis as the age of first birth. The trendline shows the average age at first birth with each satisfaction rating with life, and we also add raw data points to this plot to visualize the spread of sample points.



# Results
From the raw data displaying the distribution of first birth ages (Figure \@ref(fig:age-first-child)), we see that Canadian partners are reported most often to have their first child at the age of 25. The graph shows a right skew indicating that most Canadians have their first child early on in life (in their 20s). Notable are the spikes in frequency at the end of the graph, at ages 18 and 45. This is due to the survey methodology not recording ages below 18 and above 45. As a result, all ages below 18 and above 45 are condensed into the same values, providing an explanation. 

By grouping the data by gender and plotting multiple graphs, we are given a comparison of the average age of when one has their first child between women and men.  (Figure \@ref(fig:female-age-first-child)) shows that in Canada, females are inclined to have children earlier than men do. We observe a right skew in the distribution for females, with the most common age to have a first child being in the 20-25 interval, while the male distribution is less skewed and the most frequent ages are in the 25-30 interval. By separating the graphs by gender, we can determine that the spike in (Figure \@ref(fig:age-first-child)) at ages above 45 are caused entirely by men, and it is observed that a very low proportion of women have their first child after 40-45 years of age. This could be explained by women gradually becoming unable to have children as a result of natural human aging, and men choosing to have partners and have their first child at older ages with women of younger age. The conclusion from this also may also provide an explanation to why the average age for men appears to be higher than for women. 

In order to gain more information about the relationship between socioeconomic factors and the age that Canadians have their first children, we plotted the data from our first graph once again, but grouped information between different education levels of individuals. (Figure \@ref(fig:education)) shows varying levels of skew between different education groups. Generally, it can be seen that the higher education level that one receives, the later they have their first child on average. This can be observed in the 25-30 age range, where as births for people with less than a high school education are shown to be decreasing, births for people with a bachelor's education or higher peak. As these individuals are still in their studies through their early and mid 20s, compared to those who stop education before or after high school and therefore not distracted by post-secondary education, it is reasonable to believe that one of the contributing factors towards this trend is the burden of post-secondary education distracting individuals from choosing to have a child, consequently delaying their opportunities years later than those with no post-secondary education. 

# Discussion


# Survey


# References


# Appendix
